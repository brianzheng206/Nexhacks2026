name: Swift Build Check

on:
  push:
    branches: [ main, phone-test-2 ]
    paths:
      - 'ios/**/*.swift'
      - 'ios/**/*.xcodeproj/**'
  pull_request:
    branches: [ main, phone-test-2 ]
    paths:
      - 'ios/**/*.swift'
      - 'ios/**/*.xcodeproj/**'

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Select Xcode version
      run: sudo xcode-select -s /Applications/Xcode_15.0.app/Contents/Developer || sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
      
    - name: Show Xcode version
      run: xcodebuild -version
      
    - name: Find Xcode project
      working-directory: ios
      id: find-project
      run: |
        if [ -d "RoomScanRemote.xcodeproj" ]; then
          echo "project=RoomScanRemote.xcodeproj" >> $GITHUB_OUTPUT
          echo "scheme=RoomScanRemote" >> $GITHUB_OUTPUT
        elif [ -d "RoomSensor.xcodeproj" ]; then
          echo "project=RoomSensor.xcodeproj" >> $GITHUB_OUTPUT
          echo "scheme=RoomSensor" >> $GITHUB_OUTPUT
        else
          echo "❌ No Xcode project found. Please create one or update the workflow."
          exit 1
        fi
        
    - name: Build iOS project
      working-directory: ios
      run: |
        xcodebuild -project ${{ steps.find-project.outputs.project }} \
          -scheme ${{ steps.find-project.outputs.scheme }} \
          -sdk iphonesimulator \
          -destination 'platform=iOS Simulator,name=iPhone 15,OS=latest' \
          clean build
      continue-on-error: false
      
    - name: Check for build errors
      if: failure()
      run: |
        echo "❌ Build failed! Check the logs above for errors."
        exit 1
